---
title: Arch Linux 开始
date: 2024-08-11T18:00:00+08:00
categories: 
- Linux
tags: 
- Arch
- Linux
---

```sh
# 有线网络测试
ip link
ping archlinux.org

# 确认时间同步
timedatectl

# 看一下磁盘分区
lsblk

# 设置一下分区表
# nvme0n1p1 1G EFI System
# nvme0n1p2 32G Linux Swap
# nvme0n1p3 920G Linux Root x86-64
cfdisk /dev/nvme0n1

# 格式化分区
mkfs.ext4 /dev/nvme0n1p3
mkswap /dev/nvme0n1p2
mkfs.fat -F 32 /dev/nvme0n1p1

# 挂载分区
mount /dev/nvme0n1p3 /mnt
mount --mkdir /dev/nvme0n1p1 /mnt/boot
swapon /dev/nvme0n1p2

# 安装内核和固件
pacstrap -K /mnt base linux linux-firmware
# warning不用管，是缺固件，后面有空再研究怎么补装

# 安装一些常用/必要包
pacstrap -K /mnt intel-ucode networkmanager vim sudo base-devel git

# 生成文件系统表
genfstab -U /mnt >> /mnt/etc/fstab

# 进chroot
arch-chroot /mnt

# 设置timezone
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc

# 但是会时间漂移
vim /etc/systemd/timesyncd.conf
###
[Time]
NTP=ntp.ntsc.ac.cn cn.ntp.org.cn
### systemctl status systemd-timesyncd.service

vim /etc/locale.gen
###
en_US.UTF-8 UTF-8
zh_CN.UTF-8 UTF-8
###
locale-gen

vim /etc/locale.conf
###
LANG=en_US.UTF-8
###

vim /etc/hostname
###
pinkarch
###

# 初始化Ram盘环境
mkinitcpio -P

# 设置root密码
password

# 添加用户
useradd -m zhangjunbo
passwd zhangjunbo
vim /etc/sudoers.d/zhangjubo
###
zhangjunbo ALL=(ALL:ALL) ALL
###

# grub
pacman -S grub efibootmgr
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=GRUB
grub-mkconfig -o /boot/grub/grub.cfg

# 重启
exit
umount -R /mnt
reboot

```



```sh
# 开启网络服务
systemctl enable NetworkManager
systemctl start NetworkManager
# 等几秒
ping archlinux.org

# pacman
sudo vim /etc/pacman.conf
###
Color
ParallelDownloads = 5
[multilib]
Include = /etc/pacman.d/mirrorlist
###
sudo pacman -Syu

# 显示服务：Wayland协议
sudo pacman -S wayland

# nvidia
sudo pacman -S nvidia nvidia-utils lib32-nvidia-utils
sudo vim /etc/modprobe.d/nvidia_drm.conf
### 不启用modeset重启会黑屏
options nvidia_drm modeset=1
options nvidia_drm fbdev=1
###
sudo vim /etc/mkinitcpio.conf
# 移除 HOOKS 里的 kms
MODULES=(nvidia nvidia_modeset nvidia_uvm nvidia_drm)
###
sudo mkinitcpio -P
sudo mkdir /etc/pacman.d/hook
sudo vim /etc/pacman.d/hooks/nvidia.hook
###
[Trigger]
Operation=Install
Operation=Upgrade
Operation=Remove
Type=Package
# Uncomment the installed NVIDIA package
Target=nvidia
#Target=nvidia-open
#Target=nvidia-lts
# If running a different kernel, modify below to match
Target=linux
[Action]
Description=Updating NVIDIA module in initcpio
Depends=mkinitcpio
When=PostTransaction
NeedsTargets
Exec=/bin/sh -c 'while read -r trg; do case $trg in linux*) exit 0; esac; done; /usr/bin/mkinitcpio -P'
###
# 重启
sudo reboot
# 检查是否启用modeset
sudo cat /sys/module/nvidia_drm/parameters/modeset
sudo cat /sys/module/nvidia_drm/parameters/fbdev

# hyprland
sudo pacman -S hyprland polkit polkit-kde-agent
hyprland
# super+M 再动一下鼠标关掉 hyprland
vim 〜/.config/hypr/hyprland.conf
###
autogenerated = 0
exec-once = waybar -c ~/.config/waybar/config.jsonc
exec-once = /usr/lib/polkit-kde-authentication-agent-1
###
# 终端模拟器 文件管理器 状态条 桌面壁纸 搜索菜单 浏览器
sudo pacman -S kitty dolphin waybar hyprpaper wofi
# 选择pipewire-jack ffmpeg
mkdir ~/.config/waybar
touch ~/.config/waybar/config.jsonc
sudo cat /etc/xdg/waybar/config.jsonc > ~/.config/waybar/config.jsonc
vim ~/.config/waybar/config.jsonc
###
"hyprland/workspaces": {
  ...
}
###
Hyprland


```



```sh
# google-chrome
sudo pacman -S libxss ttf-liberation
mkdir ~/aur
cd ~/aur
git clone https://aur.archlinux.org/google-chrome.git
cd google-chrome
makepkg
sudo pacman -U google-chrome-xxxx.pkg.tar.zst

# 中文字体 emoji 数学符号等
sudo pacman -S adobe-source-han-sans-cn-fonts noto-fonts

# vscode
sudo pacman -S libnotify lsof
cd ~/aur
git clone https://aur.archlinux.org/visual-studio-code-bin.git
cd visual-studio-code-bin
makepkg
sudo pacman -U visual-studio-code-bin-xxxx.pkg.tar.zst

# 输入法
sudo pacman -S gtk4 fcitx5 fcitx5-configtool fcitx5-gtk fcitx5-chinese-addons fcitx5-pinyin-zhwiki

# ssh
sudo pacman -S openssh
ssh-keygen

# zsh
sudo pacman -S zsh
git clone https://aur.archlinux.org/oh-my-zsh-git.git
sh -c "$(curl -fsSL https://install.ohmyz.sh/)"
chsh -s /bin/zsh


# proxy
cd ~/aur
git clone https://aur.archlinux.org/proxyman-git.git
cd proxyman-git
makepkg
sudo pacman -U proxyman-git-xxxx.pkg.tar.zst
echo "export PATH=$PATH:~/.local/bin" >> ~/.zshrc

# python
python --version
sudo pacman -S pyenv python-pipx
pipx install poetry
pyenv install 3.9
pyenv global 3.9
```

